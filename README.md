# Foundation-Dataset

----find daily sales, on hands, and on order
----find daily receipts (KEY_RECs)
----find weekly on hand adjustments

----find Zippedi packdown attempts
----find Zippedi SKUs found in overheads

----find overhead management tags
      ---how often do overhead management tags have inventory despite system on hands of 0

WITH STR_SKU_DAY_SLS AS (
SELECT CAL_DT, STR_NBR, STR_VOL_LVL_CD, SKU_NBR, SKU_CRT_DT, SKU_VLCTY_CD, SKU_STAT_CD, CURR_RETL_AMT, CURR_COST_AMT
, OH_QTY, RAW_OH_QTY, OO_QTY, TRGT_OH_QTY,
CLR_DT CLEARANCE_DATE, SELL_UOM_QTY, BUY_UOM_QTY CASE_PACK, 
GROSS_UNT_SLS, NET_UNT_SLS
FROM `pr-edw-views-thd.SCHN_INV.STR_SKU_ACINV_DLY` 
WHERE PARTITIONDATE >= '2020-03-17'
AND STR_NBR = '6986'
AND SKU_NBR = 1005394426
ORDER BY CAL_DT
)

---On Hand Changes over time
, OHADJ AS (
select A.FSCL_YR_WK_KEY_VAL, CNT_CMPLT_DT, STR_NBR, SKU_NBR, SKU_CRT_DT, MER_DEPT_NBR, REPLE_CNT_TYP_CD, REPLE_CNT_STAT_CD, WRK_REPLE_CNT_CD,
BGN_OH_QTY, END_OH_QTY, VLCTY_IND, AUD_REQD_FLG, 
CASE WHEN BGN_OH_QTY < 0 AND END_OH_QTY > BGN_OH_QTY AND END_OH_QTY = 0 THEN 'UP_TO_ZERO'
    WHEN END_OH_QTY > BGN_OH_QTY THEN 'UP' 
    WHEN BGN_OH_QTY > END_OH_QTY AND END_OH_QTY = 0 THEN 'DOWN_TO_ZERO'
    WHEN BGN_OH_QTY > END_OH_QTY THEN 'DOWN' 
    ELSE 'HMM' END OH_ADJ_BUCKET,
case when END_OH_QTY = 0 THEN 1 else 0 END OH_ADJ_TO_ZERO_FLAG, 
case when BGN_OH_QTY = 0 THEN 1 else 0 END OH_ADJ_FROM_ZERO_FLAG, 
case when END_OH_QTY > BGN_OH_QTY THEN 1 ELSE 0 END OH_ADJ_UP, 
case when END_OH_QTY < BGN_OH_QTY THEN 1 ELSE 0 END OH_ADJ_DOWN

from `pr-edw-views-thd.SCHN_INV.WH_W_STRSK_RCNT` A
WHERE STR_NBR = '6986' 
AND SKU_NBR = 1005394426
ORDER BY FSCL_YR_WK_KEY_VAL  DESC
) 

  ---SKU found in overheads over time
, OVERHEAD_DATA AS (

  /*
  SELECT * 
  FROM `analytics-met-thd.MET_STAGE.OVERHEAD_MULTIPLE_LOCATION`
  WHERE STORE_NUMBER = '6986'
  AND SKU_NUMBER = '1005394426'
  AND LAST_TIME_SEEN = '2022-06-22'
  ORDER BY LAST_TIME_SEEN
  */
SELECT STORE_NUMBER,  SKU_NUMBER, LAST_TIME_SEEN, ARRAY_AGG(STRUCT(landmark, overhead_multiple_location_id, aisle_part)) AS LOCATIONS
  FROM `analytics-met-thd.MET_STAGE.OVERHEAD_MULTIPLE_LOCATION`
  WHERE STORE_NUMBER = '6986'
  AND SKU_NUMBER = '1005394426'
  --  AND LAST_TIME_SEEN = '2022-06-22'
  GROUP By 1,2,3
ORDER BY LAST_TIME_SEEN
)

SELECT A.*, B.*, C.*
FROM STR_SKU_DAY_SLS A 
LEFT JOIN OHADJ B
  ON A.STR_NBR = B.STR_NBR
  AND A.SKU_NBR = B.SKU_NBR
  AND A.SKU_CRT_DT = B.SKU_CRT_DT
  AND A.CAL_DT = B.CNT_CMPLT_DT
LEFT JOIN OVERHEAD_DATA C
  ON A.STR_NBR = C.STORE_NUMBER
  AND A.SKU_NBR = CAST(C.SKU_NUMBER AS INT64)
  AND A.CAL_DT = CAST(C.LAST_TIME_SEEN AS DATE)

![image](https://user-images.githubusercontent.com/17092274/208140684-21e2e7d6-0a78-4133-8760-c40259d79e44.png)
